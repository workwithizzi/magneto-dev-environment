#!/bin/bash
# Install and configure Magento
source bin/utils
source env/db.env

# Make sure magento is executable
# bin/rootnotty chmod u+x bin/magento
bin/clinotty chmod u+x bin/magento

bin/clinotty composer config http-basic.repo.magento.com "$COMPOSER_AUTH_USERNAME" "$COMPOSER_AUTH_PASSWORD"
COMPOSER_AUTH_USERNAME=''
COMPOSER_AUTH_PASSWORD=''


print_doing "Forcing reinstall of composer deps to ensure perms & reqs..."
bin/clinotty composer global require hirak/prestissimo
bin/clinotty composer update


# print_doing "Turning on developer mode"
# bin/magento deploy:mode:set developer
# bin/magento indexer:reindex

# print_doing "Forcing deploy of static content to speed up initial requests"
# bin/magento setup:static-content:deploy -f

# print_doing "Re-indexing with Elasticsearch"
# bin/magento indexer:reindex

# print_doing "Clearing the cache to apply updates"
# bin/magento cache:flush

# print_doing "Disabling Two-Factor Authentication for local development"
# bin/magento module:disable Magento_TwoFactorAuth --clear-static-content

# print_success "Your project should be ready to go. Details:"
# bin/info

print_doing "Clearing the cache to apply updates..."
bin/clinotty bin/magento cache:flush

print_doing "Copying files from container to host after install..."
bin/copyfromcontainer app
bin/copyfromcontainer vendor