#!/bin/bash
source bin/utils

print_doing "Merging the downloaded Magento files with ./src"

if [ ! -d "src" ]; then
	mkdir -p "src"
fi

if [ -d "$EXTRACTION_DIR/.git" ]; then
	rm -rf "$EXTRACTION_DIR/.git"
fi

if [ -d "$EXTRACTION_DIR/.github" ]; then
	rm -rf "$EXTRACTION_DIR/.github"
fi

if [ -d "$EXTRACTION_DIR/vendor" ]; then
	rm -rf "$EXTRACTION_DIR/vendor"
fi

rsync --ignore-existing -raz "$EXTRACTION_DIR/" "src/"

print_success "Files merged"


if [ "$1" == "-s" ]; then
	REPLY_REMOVE="y"
else
	echo "‚ùì Do you want to remove the $EXTRACTION_DIR directory where the files where first extracted? [y|n]"
	echo "   Press [return] or 'y' to remove them"
	read -r REPLY_REMOVE
fi
REMOVE_TEMP_DIR="${REPLY_REMOVE:-"y"}"


if [[ $REMOVE_TEMP_DIR =~ ^[y]$ ]]; then
	rm -rf "$EXTRACTION_DIR"
	print_success "$EXTRACTION_DIR removed"
fi
